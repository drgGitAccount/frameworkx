/**
 * FrameworkX JavaScript Bundle
 * Generated by build script
 */

// File: collapse.js
/**
 * FrameworkX Collapse
 * A lightweight collapse component
 */

class Collapse {
  constructor(element, options = {}) {
    this.element = element;
    this.options = {
      toggle: true,
      parent: null,
      ...options
    };
    
    this.isTransitioning = false;
    this.triggerArray = [];
    this.accordionElements = [];
    
    this.init();
  }
  
  init() {
    // Get the target element
    this.target = this.element.getAttribute('data-target') || this.element.getAttribute('href');
    this.targetElement = document.querySelector(this.target);
    
    if (!this.targetElement) {
      return;
    }
    
    // Add ARIA attributes
    this.element.setAttribute('aria-expanded', 'false');
    this.targetElement.setAttribute('aria-hidden', 'true');
    
    // Initialize height
    this.targetElement.style.height = '0px';
    this.targetElement.style.overflow = 'hidden';
    this.targetElement.style.transition = 'height 0.35s ease';
    
    // Bind events
    this.bindEvents();
    
    // Handle accordion behavior
    if (this.options.parent) {
      this.handleAccordion();
    }
  }
  
  bindEvents() {
    this.element.addEventListener('click', (e) => {
      e.preventDefault();
      this.toggle();
    });
  }
  
  handleAccordion() {
    const parent = document.querySelector(this.options.parent);
    if (!parent) return;
    
    const triggers = parent.querySelectorAll('[data-toggle="collapse"]');
    triggers.forEach(trigger => {
      if (trigger !== this.element) {
        const target = trigger.getAttribute('data-target') || trigger.getAttribute('href');
        const targetElement = document.querySelector(target);
        if (targetElement) {
          this.accordionElements.push(targetElement);
        }
      }
    });
  }
  
  toggle() {
    if (this.isTransitioning) {
      return;
    }
    
    if (this.targetElement.classList.contains('show')) {
      this.hide();
    } else {
      this.show();
    }
  }
  
  show() {
    if (this.isTransitioning || this.targetElement.classList.contains('show')) {
      return;
    }
    
    // Close other accordion items
    if (this.options.parent) {
      this.accordionElements.forEach(element => {
        if (element.classList.contains('show')) {
          const instance = Collapse.getInstance(element);
          if (instance) {
            instance.hide();
          }
        }
      });
    }
    
    this.isTransitioning = true;
    
    // Update ARIA attributes
    this.element.setAttribute('aria-expanded', 'true');
    this.targetElement.setAttribute('aria-hidden', 'false');
    
    // Add show class and set height
    this.targetElement.classList.add('show');
    const height = this.targetElement.scrollHeight;
    this.targetElement.style.height = height + 'px';
    
    // Transition end
    const transitionEnd = () => {
      this.targetElement.style.height = '';
      this.targetElement.style.overflow = '';
      this.isTransitioning = false;
      this.targetElement.removeEventListener('transitionend', transitionEnd);
      
      // Emit event
      this.emitEvent('shown');
    };
    
    this.targetElement.addEventListener('transitionend', transitionEnd);
    this.emitEvent('show');
  }
  
  hide() {
    if (this.isTransitioning || !this.targetElement.classList.contains('show')) {
      return;
    }
    
    this.isTransitioning = true;
    
    // Set height for transition
    this.targetElement.style.height = this.targetElement.scrollHeight + 'px';
    this.targetElement.style.overflow = 'hidden';
    
    // Force reflow
    this.targetElement.offsetHeight;
    
    // Update ARIA attributes
    this.element.setAttribute('aria-expanded', 'false');
    this.targetElement.setAttribute('aria-hidden', 'true');
    
    // Start transition
    this.targetElement.style.height = '0px';
    
    // Transition end
    const transitionEnd = () => {
      this.targetElement.classList.remove('show');
      this.targetElement.style.height = '';
      this.targetElement.style.overflow = '';
      this.isTransitioning = false;
      this.targetElement.removeEventListener('transitionend', transitionEnd);
      
      // Emit event
      this.emitEvent('hidden');
    };
    
    this.targetElement.addEventListener('transitionend', transitionEnd);
    this.emitEvent('hide');
  }
  
  emitEvent(eventName) {
    const event = new CustomEvent(`fw.${eventName}`, {
      detail: { collapse: this }
    });
    this.element.dispatchEvent(event);
  }
  
  // Static methods
  static getInstance(element) {
    return element._fwCollapse || null;
  }
  
  static getOrCreateInstance(element, options = {}) {
    return element._fwCollapse || new Collapse(element, options);
  }
}

// Auto-initialize collapse elements
document.addEventListener('DOMContentLoaded', () => {
  const triggers = document.querySelectorAll('[data-toggle="collapse"]');
  triggers.forEach(trigger => {
    Collapse.getOrCreateInstance(trigger);
  });
});

// File: dropdown.js
/**
 * FrameworkX Dropdown
 * A lightweight dropdown component
 */

class Dropdown {
  constructor(element, options = {}) {
    this.element = element;
    this.options = {
      offset: [0, 2],
      flip: true,
      boundary: 'clippingParents',
      reference: 'toggle',
      display: 'dynamic',
      popperConfig: null,
      ...options
    };
    
    this.menu = null;
    this.isOpen = false;
    
    this.init();
  }
  
  init() {
    // Find the dropdown menu
    const target = this.element.getAttribute('data-target') || 
                   this.element.getAttribute('href') || 
                   this.element.nextElementSibling;
    
    this.menu = document.querySelector(target);
    
    if (!this.menu) {
      console.warn('Dropdown menu not found for element:', this.element);
      return;
    }
    
    // Add ARIA attributes
    this.element.setAttribute('aria-haspopup', 'true');
    this.element.setAttribute('aria-expanded', 'false');
    this.menu.setAttribute('aria-hidden', 'true');
    
    // Bind events
    this.bindEvents();
  }
  
  bindEvents() {
    // Click to toggle
    this.element.addEventListener('click', (e) => {
      e.preventDefault();
      this.toggle();
    });
    
    // Click outside to close
    document.addEventListener('click', (e) => {
      if (!this.element.contains(e.target) && !this.menu.contains(e.target)) {
        this.hide();
      }
    });
    
    // Keyboard navigation
    this.element.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.toggle();
      }
    });
    
    // Menu keyboard navigation
    this.menu.addEventListener('keydown', (e) => {
      this.handleKeyboard(e);
    });
  }
  
  handleKeyboard(e) {
    const items = this.menu.querySelectorAll('.fw-dropdown-item:not(.disabled)');
    const currentIndex = Array.from(items).findIndex(item => item === document.activeElement);
    
    switch (e.key) {
      case 'ArrowDown':
        e.preventDefault();
        const nextIndex = (currentIndex + 1) % items.length;
        items[nextIndex]?.focus();
        break;
        
      case 'ArrowUp':
        e.preventDefault();
        const prevIndex = currentIndex === 0 ? items.length - 1 : currentIndex - 1;
        items[prevIndex]?.focus();
        break;
        
      case 'Home':
        e.preventDefault();
        items[0]?.focus();
        break;
        
      case 'End':
        e.preventDefault();
        items[items.length - 1]?.focus();
        break;
        
      case 'Escape':
        e.preventDefault();
        this.hide();
        this.element.focus();
        break;
        
      case 'Enter':
      case ' ':
        e.preventDefault();
        if (document.activeElement.classList.contains('fw-dropdown-item')) {
          document.activeElement.click();
        }
        break;
        
      case 'Tab':
        this.hide();
        break;
    }
  }
  
  toggle() {
    if (this.isOpen) {
      this.hide();
    } else {
      this.show();
    }
  }
  
  show() {
    if (this.isOpen) {
      return;
    }
    
    // Close other dropdowns
    document.querySelectorAll('.fw-dropdown.show').forEach(dropdown => {
      const instance = Dropdown.getInstance(dropdown);
      if (instance) {
        instance.hide();
      }
    });
    
    // Update state
    this.isOpen = true;
    this.element.classList.add('show');
    this.menu.classList.add('show');
    
    // Update ARIA attributes
    this.element.setAttribute('aria-expanded', 'true');
    this.menu.setAttribute('aria-hidden', 'false');
    
    // Position the menu
    this.position();
    
    // Focus first item
    const firstItem = this.menu.querySelector('.fw-dropdown-item:not(.disabled)');
    if (firstItem) {
      firstItem.focus();
    }
    
    // Emit event
    this.emitEvent('show');
  }
  
  hide() {
    if (!this.isOpen) {
      return;
    }
    
    // Update state
    this.isOpen = false;
    this.element.classList.remove('show');
    this.menu.classList.remove('show');
    
    // Update ARIA attributes
    this.element.setAttribute('aria-expanded', 'false');
    this.menu.setAttribute('aria-hidden', 'true');
    
    // Emit event
    this.emitEvent('hide');
  }
  
  position() {
    const rect = this.element.getBoundingClientRect();
    const menuRect = this.menu.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    
    // Check if menu should be positioned above
    const spaceBelow = viewportHeight - rect.bottom;
    const spaceAbove = rect.top;
    
    if (spaceBelow < menuRect.height && spaceAbove > menuRect.height) {
      // Position above
      this.menu.style.top = 'auto';
      this.menu.style.bottom = '100%';
      this.menu.style.marginBottom = this.options.offset[1] + 'px';
    } else {
      // Position below
      this.menu.style.top = '100%';
      this.menu.style.bottom = 'auto';
      this.menu.style.marginTop = this.options.offset[1] + 'px';
    }
    
    // Position horizontally
    this.menu.style.left = '0';
    this.menu.style.right = 'auto';
  }
  
  emitEvent(eventName) {
    const event = new CustomEvent(`fw.${eventName}`, {
      detail: { dropdown: this }
    });
    this.element.dispatchEvent(event);
  }
  
  // Static methods
  static getInstance(element) {
    return element._fwDropdown || null;
  }
  
  static getOrCreateInstance(element, options = {}) {
    return element._fwDropdown || new Dropdown(element, options);
  }
}

// Auto-initialize dropdown elements
document.addEventListener('DOMContentLoaded', () => {
  const dropdowns = document.querySelectorAll('.fw-dropdown');
  dropdowns.forEach(dropdown => {
    Dropdown.getOrCreateInstance(dropdown);
  });
});

// File: modal.js
/**
 * FrameworkX Modal
 * A lightweight modal component
 */

class Modal {
  constructor(element, options = {}) {
    this.element = element;
    this.options = {
      backdrop: true,
      keyboard: true,
      focus: true,
      show: true,
      ...options
    };
    
    this.isShown = false;
    this.backdropElement = null;
    this.dialogElement = null;
    
    this.init();
  }
  
  init() {
    // Find dialog element
    this.dialogElement = this.element.querySelector('.fw-modal-dialog');
    
    // Bind events
    this.bindEvents();
    
    // Auto-show if option is set
    if (this.options.show) {
      this.show();
    }
  }
  
  bindEvents() {
    // Close buttons
    const closeButtons = this.element.querySelectorAll('[data-dismiss="modal"]');
    closeButtons.forEach(button => {
      button.addEventListener('click', () => this.hide());
    });
    
    // Keyboard events
    if (this.options.keyboard) {
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isShown) {
          this.hide();
        }
      });
    }
    
    // Click on backdrop to close
    this.element.addEventListener('click', (e) => {
      if (e.target === this.element && this.options.backdrop) {
        this.hide();
      }
    });
  }
  
  show() {
    if (this.isShown) {
      return;
    }
    
    // Create backdrop
    if (this.options.backdrop) {
      this.createBackdrop();
    }
    
    // Show modal
    this.isShown = true;
    this.element.style.display = 'block';
    this.element.classList.add('show');
    
    // Add body class
    document.body.classList.add('fw-modal-open');
    
    // Focus management
    if (this.options.focus) {
      this.enforceFocus();
    }
    
    // Emit event
    this.emitEvent('show');
    
    // Focus trap
    setTimeout(() => {
      this.trapFocus();
    }, 100);
  }
  
  hide() {
    if (!this.isShown) {
      return;
    }
    
    this.isShown = false;
    this.element.classList.remove('show');
    
    // Remove body class
    document.body.classList.remove('fw-modal-open');
    
    // Hide modal after transition
    setTimeout(() => {
      this.element.style.display = 'none';
      this.removeBackdrop();
      this.emitEvent('hidden');
    }, 300);
    
    // Emit event
    this.emitEvent('hide');
  }
  
  createBackdrop() {
    this.backdropElement = document.createElement('div');
    this.backdropElement.className = 'fw-modal-backdrop fade';
    document.body.appendChild(this.backdropElement);
    
    // Trigger reflow and add show class
    this.backdropElement.offsetHeight;
    this.backdropElement.classList.add('show');
  }
  
  removeBackdrop() {
    if (this.backdropElement) {
      this.backdropElement.classList.remove('show');
      setTimeout(() => {
        if (this.backdropElement && this.backdropElement.parentNode) {
          this.backdropElement.parentNode.removeChild(this.backdropElement);
          this.backdropElement = null;
        }
      }, 300);
    }
  }
  
  enforceFocus() {
    document.addEventListener('focusin', (e) => {
      if (this.isShown && !this.element.contains(e.target)) {
        e.preventDefault();
        this.element.focus();
      }
    });
  }
  
  trapFocus() {
    const focusableElements = this.element.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );
    
    if (focusableElements.length > 0) {
      focusableElements[0].focus();
    }
  }
  
  emitEvent(eventName) {
    const event = new CustomEvent(`fw.${eventName}`, {
      detail: { modal: this }
    });
    this.element.dispatchEvent(event);
  }
  
  // Static methods
  static getInstance(element) {
    return element._fwModal || null;
  }
  
  static getOrCreateInstance(element, options = {}) {
    return element._fwModal || new Modal(element, options);
  }
}

// Auto-initialize modal elements
document.addEventListener('DOMContentLoaded', () => {
  const modals = document.querySelectorAll('.fw-modal');
  modals.forEach(modal => {
    Modal.getOrCreateInstance(modal);
  });
  
  // Handle modal triggers
  const triggers = document.querySelectorAll('[data-toggle="modal"]');
  triggers.forEach(trigger => {
    trigger.addEventListener('click', (e) => {
      e.preventDefault();
      const target = trigger.getAttribute('data-target') || trigger.getAttribute('href');
      const modalElement = document.querySelector(target);
      if (modalElement) {
        const modal = Modal.getOrCreateInstance(modalElement);
        modal.show();
      }
    });
  });
});
